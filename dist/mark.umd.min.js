/*!***************************************************
* mark.js v10.0.0
* https://github.com/michaelts1/mark.js/tree/ooxml
* Copyright (c) 2014–2022, Julian Kühnel
* Released under the MIT license https://git.io/vwTVl
*****************************************************/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Mark=t()}(this,function(){"use strict";class e{constructor(e,t=!0,s=[],r=5e3){this.ctx=e,this.iframes=t,this.exclude=s,this.iframesTimeout=r}static isNotTextRun(e){return!["w:t","m:t"].includes(e.tagName)}getContexts(){let e,t=[];return(e=void 0!==this.ctx&&this.ctx?NodeList.prototype.isPrototypeOf(this.ctx)?Array.prototype.slice.call(this.ctx):Array.isArray(this.ctx)?this.ctx:"string"==typeof this.ctx?Array.prototype.slice.call(document.querySelectorAll(this.ctx)):[this.ctx]:[]).forEach(e=>{const s=t.filter(t=>t.contains(e)).length>0;-1!==t.indexOf(e)||s||t.push(e)}),t}getIframeContents(e,t,s=(()=>{})){let r;try{const t=e.contentWindow;if(r=t.document,!t||!r)throw new Error("iframe inaccessible")}catch(e){s()}r&&t(r)}isIframeBlank(e){const t="about:blank",s=e.getAttribute("src").trim();return e.contentWindow.location.href===t&&s!==t&&s}observeIframeLoad(e,t,s){let r=!1,n=null;const i=()=>{if(!r){r=!0,clearTimeout(n);try{this.isIframeBlank(e)||(e.removeEventListener("load",i),this.getIframeContents(e,t,s))}catch(e){s()}}};e.addEventListener("load",i),n=setTimeout(i,this.iframesTimeout)}onIframeReady(e,t,s){try{"complete"===e.contentWindow.document.readyState?this.isIframeBlank(e)?this.observeIframeLoad(e,t,s):this.getIframeContents(e,t,s):this.observeIframeLoad(e,t,s)}catch(e){s()}}waitForIframes(e,t){let s=0;this.forEachIframe(e,()=>!0,e=>{s++,this.waitForIframes(e.querySelector("html"),()=>{--s||t()})},e=>{e||t()})}forEachIframe(t,s,r,n=(()=>{})){let i=t.querySelectorAll("iframe"),a=i.length,o=0;i=Array.prototype.slice.call(i);const h=()=>{--a<=0&&n(o)};a||h(),i.forEach(t=>{e.isNotTextRun(t,this.exclude)?h():this.onIframeReady(t,e=>{s(t)&&(o++,r(e)),h()},h)})}createIterator(e,t,s){return document.createNodeIterator(e,t,s,!1)}createInstanceOnIframe(t){return new e(t.querySelector("html"),this.iframes)}compareNodeIframe(e,t,s){if(e.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_PRECEDING){if(null===t)return!0;if(t.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_FOLLOWING)return!0}return!1}getIteratorNode(e){const t=e.previousNode();let s;return{prevNode:t,node:s=null===t?e.nextNode():e.nextNode()&&e.nextNode()}}checkIframeFilter(e,t,s,r){let n=!1,i=!1;return r.forEach((e,t)=>{e.val===s&&(n=t,i=e.handled)}),this.compareNodeIframe(e,t,s)?(!1!==n||i?!1===n||i||(r[n].handled=!0):r.push({val:s,handled:!0}),!0):(!1===n&&r.push({val:s,handled:!1}),!1)}handleOpenIframes(e,t,s,r){e.forEach(e=>{e.handled||this.getIframeContents(e.val,e=>{this.createInstanceOnIframe(e).forEachNode(t,s,r)})})}iterateThroughNodes(e,t,s,r,n){const i=this.createIterator(t,e,r);let a,o,h=[],l=[],c=()=>(({prevNode:o,node:a}=this.getIteratorNode(i)),a);if(this.iframes)for(;c();)this.forEachIframe(t,e=>this.checkIframeFilter(a,o,e,h),t=>{this.createInstanceOnIframe(t).forEachNode(e,e=>l.push(e),r)}),l.push(a);else for(;a=i.nextNode();)l.push(a);l.forEach(e=>{s(e)}),this.iframes&&this.handleOpenIframes(h,e,s,r),n()}forEachNode(e,t,s,r=(()=>{})){const n=this.getContexts();let i=n.length;i||r(),n.forEach(n=>{const a=()=>{this.iterateThroughNodes(e,n,t,s,()=>{--i<=0&&r()})};this.iframes?this.waitForIframes(n,a):a()})}}class t{constructor(e){this.opt=Object.assign({},{diacritics:!0,synonyms:{},accuracy:"partially",caseSensitive:!1,ignoreJoiners:!1,ignorePunctuation:[],wildcards:"disabled"},e)}create(e){return"disabled"!==this.opt.wildcards&&(e=this.setupWildcardsRegExp(e)),e=this.escapeStr(e),Object.keys(this.opt.synonyms).length&&(e=this.createSynonymsRegExp(e)),(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.setupIgnoreJoinersRegExp(e)),this.opt.diacritics&&(e=this.createDiacriticsRegExp(e)),e=this.createMergedBlanksRegExp(e),(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.createJoinersRegExp(e)),"disabled"!==this.opt.wildcards&&(e=this.createWildcardsRegExp(e)),e=this.createAccuracyRegExp(e),new RegExp(e,`gm${this.opt.caseSensitive?"":"i"}`)}sortByLength(e){return e.sort((e,t)=>e.length===t.length?e>t?1:-1:t.length-e.length)}escapeStr(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}createSynonymsRegExp(e){const t=this.opt.synonyms,s=this.opt.caseSensitive?"":"i",r=this.opt.ignoreJoiners||this.opt.ignorePunctuation.length?"\0":"";for(let n in t)if(t.hasOwnProperty(n)){let i=Array.isArray(t[n])?t[n]:[t[n]];i.unshift(n),(i=this.sortByLength(i).map(e=>("disabled"!==this.opt.wildcards&&(e=this.setupWildcardsRegExp(e)),e=this.escapeStr(e))).filter(e=>""!==e)).length>1&&(e=e.replace(new RegExp(`(${i.map(e=>this.escapeStr(e)).join("|")})`,`gm${s}`),r+`(${i.map(e=>this.processSynonyms(e)).join("|")})`+r))}return e}processSynonyms(e){return(this.opt.ignoreJoiners||this.opt.ignorePunctuation.length)&&(e=this.setupIgnoreJoinersRegExp(e)),e}setupWildcardsRegExp(e){return(e=e.replace(/(?:\\)*\?/g,e=>"\\"===e.charAt(0)?"?":"")).replace(/(?:\\)*\*/g,e=>"\\"===e.charAt(0)?"*":"")}createWildcardsRegExp(e){let t="withSpaces"===this.opt.wildcards;return e.replace(/\u0001/g,t?"[\\S\\s]?":"\\S?").replace(/\u0002/g,t?"[\\S\\s]*?":"\\S*")}setupIgnoreJoinersRegExp(e){return e.replace(/[^(|)\\]/g,(e,t,s)=>{let r=s.charAt(t+1);return/[(|)\\]/.test(r)||""===r?e:e+"\0"})}createJoinersRegExp(e){let t=[];const s=this.opt.ignorePunctuation;return Array.isArray(s)&&s.length&&t.push(this.escapeStr(s.join(""))),this.opt.ignoreJoiners&&t.push("\\u00ad\\u200b\\u200c\\u200d"),t.length?e.split(/\u0000+/).join(`[${t.join("")}]*`):e}createDiacriticsRegExp(e){const t=this.opt.caseSensitive?"":"i",s=this.opt.caseSensitive?["aàáảãạăằắẳẵặâầấẩẫậäåāą","AÀÁẢÃẠĂẰẮẲẴẶÂẦẤẨẪẬÄÅĀĄ","cçćč","CÇĆČ","dđď","DĐĎ","eèéẻẽẹêềếểễệëěēę","EÈÉẺẼẸÊỀẾỂỄỆËĚĒĘ","iìíỉĩịîïī","IÌÍỈĨỊÎÏĪ","lł","LŁ","nñňń","NÑŇŃ","oòóỏõọôồốổỗộơởỡớờợöøō","OÒÓỎÕỌÔỒỐỔỖỘƠỞỠỚỜỢÖØŌ","rř","RŘ","sšśșş","SŠŚȘŞ","tťțţ","TŤȚŢ","uùúủũụưừứửữựûüůū","UÙÚỦŨỤƯỪỨỬỮỰÛÜŮŪ","yýỳỷỹỵÿ","YÝỲỶỸỴŸ","zžżź","ZŽŻŹ"]:["aàáảãạăằắẳẵặâầấẩẫậäåāąAÀÁẢÃẠĂẰẮẲẴẶÂẦẤẨẪẬÄÅĀĄ","cçćčCÇĆČ","dđďDĐĎ","eèéẻẽẹêềếểễệëěēęEÈÉẺẼẸÊỀẾỂỄỆËĚĒĘ","iìíỉĩịîïīIÌÍỈĨỊÎÏĪ","lłLŁ","nñňńNÑŇŃ","oòóỏõọôồốổỗộơởỡớờợöøōOÒÓỎÕỌÔỒỐỔỖỘƠỞỠỚỜỢÖØŌ","rřRŘ","sšśșşSŠŚȘŞ","tťțţTŤȚŢ","uùúủũụưừứửữựûüůūUÙÚỦŨỤƯỪỨỬỮỰÛÜŮŪ","yýỳỷỹỵÿYÝỲỶỸỴŸ","zžżźZŽŻŹ"];let r=[];return e.split("").forEach(n=>{s.every(s=>{if(-1!==s.indexOf(n)){if(r.indexOf(s)>-1)return!1;e=e.replace(new RegExp(`[${s}]`,`gm${t}`),`[${s}]`),r.push(s)}return!0})}),e}createMergedBlanksRegExp(e){return e.replace(/[\s]+/gim,"[\\s]+")}createAccuracyRegExp(e){let t=this.opt.accuracy,s="string"==typeof t?t:t.value,r="string"==typeof t?[]:t.limiters,n="";switch(r.forEach(e=>{n+=`|${this.escapeStr(e)}`}),s){case"partially":default:return`()(${e})`;case"complementary":return`()([^${n="\\s"+(n||this.escapeStr("!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~¡¿"))}]*${e}[^${n}]*)`;case"exactly":return`(^|\\s${n})(${e})(?=$|\\s${n})`}}}class s{constructor(e){this.ctx=e,this.cacheDict={},this.ie=!1;const t=window.navigator.userAgent;(t.indexOf("MSIE")>-1||t.indexOf("Trident")>-1)&&(this.ie=!0)}set opt(e){this._opt=Object.assign({},{element:"",className:"",exclude:[],iframes:!1,iframesTimeout:5e3,separateWordSearch:!0,acrossElements:!1,separateGroups:!1,wrapAllRanges:!1,ignoreGroups:0,each:()=>{},noMatch:()=>{},filterMatch:()=>!0,filter:()=>!0,done:()=>{},debug:!1,log:window.console},e)}get opt(){return this._opt}get iterator(){return new e(this.ctx,this.opt.iframes,this.opt.exclude,this.opt.iframesTimeout)}log(e,t="debug"){const s=this.opt.log;this.opt.debug&&"object"==typeof s&&"function"==typeof s[t]&&s[t](`mark.js: ${e}`)}getSeparatedKeywords(e){let t=[];return e.forEach(e=>{this.opt.separateWordSearch?e.split(" ").forEach(e=>{e.trim()&&-1===t.indexOf(e)&&t.push(e)}):e.trim()&&-1===t.indexOf(e)&&t.push(e)}),{keywords:t.sort((e,t)=>t.length-e.length),length:t.length}}isNumeric(e){return Number(parseFloat(e))==e}checkRanges(e){if(!Array.isArray(e)||"[object Object]"!==Object.prototype.toString.call(e[0]))return this.log("markRanges() will only accept an array of objects"),this.opt.noMatch(e),[];const t=[];let s=0;return e.sort((e,t)=>e.start-t.start).forEach(e=>{let{start:r,end:n,valid:i}=this.callNoMatchOnInvalidRanges(e,s);i&&(e.start=r,e.length=n-r,t.push(e),this.opt.wrapAllRanges||(s=n))}),t}callNoMatchOnInvalidRanges(e,t){let s,r,n=!1;return e&&void 0!==e.start?(r=(s=parseInt(e.start,10))+parseInt(e.length,10),this.isNumeric(e.start)&&this.isNumeric(e.length)&&s>=t&&r>s?n=!0:(this.log("Ignoring invalid or overlapping range: "+`${JSON.stringify(e)}`),this.opt.noMatch(e))):(this.log(`Ignoring invalid range: ${JSON.stringify(e)}`),this.opt.noMatch(e)),{start:s,end:r,valid:n}}checkWhitespaceRanges(e,t,s){let r,n=!0,i=s.length,a=t-i,o=parseInt(e.start,10)-a;return(r=(o=o>i?i:o)+parseInt(e.length,10))>i&&(r=i,this.log(`End range automatically set to the max value of ${i}`)),o<0||r-o<=0?(n=!1,this.log(`Invalid range: ${JSON.stringify(e)}`),this.opt.noMatch(e)):/\S/.test(s.substring(o,r))||(n=!1,this.log("Skipping whitespace only range: "+JSON.stringify(e)),this.opt.noMatch(e)),{start:o,end:r,valid:n}}checkParents(e,t){if(e===e.parentNode.lastChild){if(t(e.parentNode))return!0;{let s=e.parentNode;for(;s===s.parentNode.lastChild;){if(t(s.parentNode))return!0;s=s.parentNode}}let s=e.parentNode.nextSibling;if(s){if(1!==s.nodeType)return!0;if(t(s))return!0}}return!1}checkNextSiblings(e,t){if(e&&1===e.nodeType){if(t(e))return;if(e.firstChild){let s,r=e.firstChild;for(;r;){if(1!==r.nodeType)return;if(t(r))return;s=r,r=r.firstChild}this.checkNextSiblings(s.nextSibling,t)}e!==e.parentNode.lastChild?this.checkNextSiblings(e.nextSibling,t):t(e.parentNode)}}prepare(e){let t=" ",s=this.opt.blockElementsBoundary;if(s.tagNames&&s.tagNames.length){let t={};for(let e in s.tagNames)t[s.tagNames[e].toLowerCase()]=1;for(let s in t)e[s]=2}else{for(let t in e)e[t]=2;e.br=1}return s.char&&(t=s.char.charAt(0)+" "),t}getTextNodesAcrossElements(e){if(this.opt.cacheTextNodes&&this.cacheDict.nodes)return this.cacheDict.lastIndex=0,this.cacheDict.lastTextIndex=0,void e(this.cacheDict);let t,s,r,n,i,a,o,h="",l=0,c=[],p=this.opt.blockElementsBoundary,d={div:1,p:1,li:1,td:1,tr:1,th:1,ul:1,ol:1,br:1,dd:1,dl:1,dt:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,blockquote:1,figcaption:1,figure:1,pre:1,table:1,thead:1,tbody:1,tfoot:1,input:1,img:1,nav:1,details:1,label:1,form:1,select:1,menu:1,menuitem:1,main:1,section:1,article:1,aside:1,picture:1,output:1,button:1,header:1,footer:1,address:1,area:1,canvas:1,map:1,fieldset:1,textarea:1,track:1,video:1,audio:1,body:1,iframe:1,meter:1,object:1,svg:1};p&&(a=this.prepare(d),o=" "+a),this.iterator.forEachNode(NodeFilter.SHOW_TEXT,e=>{if(i=0,t=h.length,s=e.textContent,r=/\s/.test(s[s.length-1]),p||!r){this.checkParents(e,e=>n=d[e.nodeName.toLowerCase()])||this.checkNextSiblings(e.nextSibling,e=>n=d[e.nodeName.toLowerCase()]),n&&(r?2===n&&(h+=s+a,i=2):1===n?(h+=s+" ",i=1):2===n&&(h+=s+o,i=3))}0===i&&(h+=s),c.push({start:t,end:h.length-i,offset:i,totalOffset:l,node:e}),l-=i},e=>this.matchesExclude(e.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT,()=>{const t={value:h,nodes:c,lastIndex:0,lastTextIndex:0};this.opt.cacheTextNodes&&(this.cacheDict=t),e(t)})}getTextNodes(e){if(this.opt.cacheTextNodes&&this.cacheDict.nodes)return void e(this.cacheDict);let t="",s=[];this.iterator.forEachNode(NodeFilter.SHOW_TEXT,e=>{s.push({start:t.length,end:(t+=e.textContent).length,offset:0,node:e})},e=>["w:t","m:t"].includes(e.parentNode.tagName)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT,()=>{const r={value:t,nodes:s,lastIndex:0,lastTextIndex:0};this.opt.cacheTextNodes&&(this.cacheDict=r),e(r)})}matchesExclude(t){return e.isNotTextRun(t,this.opt.exclude.concat(["script","style","title","head","html"]))}wrapRangeInTextNode(e,t,s){const r=e.splitText(t),n=r.splitText(s-t);return this.createMarkElement(r),n}createMarkElement(e){const t=this.opt.element?this.opt.element:"mark";let s=document.createElement(t);return s.setAttribute("data-markjs","true"),this.opt.className&&s.setAttribute("class",this.opt.className),s.textContent=e.textContent,e.parentNode.replaceChild(s,e),s}wrapRangeInTextNodeInsert(e,t,s,r,n,i){let a=s===e.node.textContent.length;if(0===t&&a){let t=this.createMarkElement(e.node);return e.node=t.childNodes[0],{retNode:e,markNode:t}}let o=e.node.splitText(t),h=o.splitText(s-t),l=this.createMarkElement(o),c={start:r,end:e.start+s,offset:0,node:l.childNodes[0]},p={start:e.start+s,end:e.end,offset:e.offset,node:h};return 0===t?i.splice(n,1,c,p):(a?i.splice(n+1,0,c):i.splice(n+1,0,c,p),e.end=r,e.offset=0),{retNode:p,markNode:l}}wrapRangeInMappedTextNode(e,t,s,r,n){let i=e.lastIndex,a=!0;if(this.opt.wrapAllRanges)for(;i>=0&&e.nodes[i].start>t;)i--;else if(t<e.lastTextIndex)return void this.log("The attempt to wrap overlapping range.");for(;i<e.nodes.length;i++)if(i+1===e.nodes.length||e.nodes[i+1].start>t){let o=e.nodes[i];if(!r(o)){i>e.lastIndex&&(e.lastIndex=i);break}const h=t-o.start,l=(s>o.end?o.end:s)-o.start;if(h>=0&&l>h){if(this.opt.wrapAllRanges){let s=this.wrapRangeInTextNodeInsert(o,h,l,t,i,e.nodes);o=s.retNode,n(s.markNode,a)}else o.node=this.wrapRangeInTextNode(o.node,h,l),o.start+=l,e.lastTextIndex=o.start,n(o.node.previousSibling,a);a=!1}if(!(s>o.end)){e.lastIndex=i;break}t=o.end+o.offset}}wrapGroups(e,t,s,r){return r((e=this.wrapRangeInTextNode(e,t,t+s)).previousSibling),e}separateGroupsD(e,t,s,r,n){let i,a,o=0,h=0,l=0,c=!1,p=0;for(;++l<t.length;)(i=t[l])&&(a=t.indices[l][0])>=o&&(p=t.indices[l][1],r(i,e,l)&&(e=this.wrapGroups(e,a-h,p-a,e=>{n(e,l)}),p>o&&(o=p),h=p,c=!0));return c?s.regex.lastIndex=0:0===t[0].length&&this.setLastIndex(s.regex,p),e}separateGroups(e,t,s,r,n){let i,a,o,h=t.index,l=-1,c=!1;for(;++l<s.groups.length;)(a=t[i=s.groups[l]])&&-1!==(o=e.textContent.indexOf(a,h))&&(r(a,e,i)?(e=this.wrapGroups(e,o,a.length,e=>{n(e,i)}),h=0,c=!0):h=o+a.length);return c&&(s.regex.lastIndex=0),e}wrapMatchGroupsD(e,t,s,r,n){let i,a,o,h=0,l=0,c=0;for(;++l<t.length;)(i=t[l])&&(a=t.indices[l][0],(this.opt.wrapAllRanges||a>=h)&&(c=t.indices[l][1],o=!1,this.wrapRangeInMappedTextNode(e,a,c,e=>r(i,e.node,l),(e,t)=>{o=!0,n(e,t,l)}),o&&c>h&&(h=c)));0===t[0].length&&this.setLastIndex(s.regex,c)}setLastIndex(e,t){t>e.lastIndex?e.lastIndex=t:t>0?e.lastIndex++:e.lastIndex=1/0}wrapMatchGroups(e,t,s,r,n){let i,a,o,h=0,l=0;const c=t.index,p=t[0];this.opt.wrapAllRanges&&this.wrapRangeInMappedTextNode(e,c,c+p.length,e=>r(p,e.node,l),function(e,t){n(e,t,l)});for(let d=0;d<s.groups.length;d++)l=s.groups[d],(i=t[l])&&(o=(a=p.indexOf(i,h))+i.length,-1!==a&&(this.wrapRangeInMappedTextNode(e,c+a,c+o,e=>r(i,e.node,l),(e,t)=>{n(e,t,l)}),h=o))}collectRegexGroupIndexes(e){let t=[],s=[],r=-1,n=1,i=0,a=!1,o=e.source,h=/^\(\?<(?![=!])|^\((?!\?)/;for(;++r<o.length;)switch(o[r]){case"(":a||(h.test(o.substring(r))?(s.push(1),0===i&&t.push(n),i++,n++):s.push(0));break;case")":a||1!==s.pop()||i--;break;case"\\":r++;break;case"[":a=!0;break;case"]":a=!1}return t}wrapSeparateGroups(e,t,s,r,n){const i=e.hasIndices?"separateGroupsD":"separateGroups",a={regex:e,groups:e.hasIndices?{}:this.collectRegexGroupIndexes(e)},o={abort:!1},h={execution:o};let l,c,p,d,g=0;this.getTextNodes(t=>{t.nodes.every(t=>{for(l=t.node,h.offset=t.start;null!==(c=e.exec(l.textContent))&&(e.hasIndices||""!==c[0])&&(h.match=c,p=d=!0,l=this[i](l,c,a,(e,t,r)=>(h.matchStart=p,h.groupIndex=r,p=!1,s(e,t,h)),(e,t)=>{d&&g++,r(e,{match:c,matchStart:d,count:g,groupIndex:t}),d=!1}),!o.abort););return!o.abort}),n(g)})}wrapMatches(e,t,s,r,n){const i=0===t?0:t+1,a={abort:!1},o={execution:a};let h,l,c=0;this.getTextNodes(t=>{t.nodes.every(t=>{for(h=t.node,o.offset=t.start;null!==(l=e.exec(this.normalizeHebrew(h.textContent)))&&""!==l[i];){if(o.match=l,!s(l[i],h,o))continue;let t=l.index;if(0!==i)for(let e=1;e<i;e++)t+=l[e].length;if(h=this.wrapGroups(h,t,l[i].length,e=>{r(e,{match:l,count:++c})}),e.lastIndex=0,a.abort)break}return!a.abort}),n(c)})}wrapGroupsAcrossElements(e,t,s,r,n){const i=e.hasIndices?"wrapMatchGroupsD":"wrapMatchGroups",a={regex:e,groups:e.hasIndices?{}:this.collectRegexGroupIndexes(e)},o={abort:!1},h={execution:o};let l,c,p,d=0;this.getTextNodesAcrossElements(t=>{for(;null!==(l=e.exec(t.value))&&(e.hasIndices||""!==l[0])&&(h.match=l,c=p=!0,this[i](t,l,a,(e,t,r)=>(h.matchStart=c,h.groupIndex=r,c=!1,s(e,t,h)),(e,t,s)=>{p&&d++,r(e,{match:l,matchStart:p,count:d,groupIndex:s,groupStart:t}),p=!1}),!o.abort););n(d)})}wrapMatchesAcrossElements(e,t,s,r,n){const i=0===t?0:t+1,a={abort:!1},o={execution:a};let h,l,c=0;this.getTextNodesAcrossElements(t=>{for(;null!==(h=e.exec(this.normalizeHebrew(t.value)))&&""!==h[i];){o.match=h,l=!0;let e=h.index;if(0!==i)for(let t=1;t<i;t++)e+=h[t].length;const n=e+h[i].length;if(this.wrapRangeInMappedTextNode(t,e,n,e=>(o.matchStart=l,o.offset=e.totalOffset,l=!1,s(h[i],e.node,o)),(e,t)=>{t&&c++,r(e,{match:h,matchStart:t,count:c})}),a.abort)break}n(c)})}wrapRangeFromIndex(e,t,s,r){let n=0;this.getTextNodes(i=>{const a=i.value.length;e.forEach((e,r)=>{let{start:o,end:h,valid:l}=this.checkWhitespaceRanges(e,a,i.value);l&&this.wrapRangeInMappedTextNode(i,o,h,s=>t(s.node,e,i.value.substring(o,h),r),(t,r)=>{r&&n++,s(t,e)})}),r(n)})}unwrapMatches(e){const t=e.parentNode;let s=document.createDocumentFragment();for(;e.firstChild;)s.appendChild(e.removeChild(e.firstChild));t.replaceChild(s,e),this.ie?this.normalizeTextNode(t):t.normalize()}normalizeTextNode(e){if(e){if(3===e.nodeType)for(;e.nextSibling&&3===e.nextSibling.nodeType;)e.nodeValue+=e.nextSibling.nodeValue,e.parentNode.removeChild(e.nextSibling);else this.normalizeTextNode(e.firstChild);this.normalizeTextNode(e.nextSibling)}}normalizeHebrew(e){return e.normalize().replace(/(\u05b9|\u05ba)ו(?![\u05b0-\u05bc\u05c7])/g,"וֹ").replace(/\u05ba/g,"ֹ")}markRegExp(e,t){if(this.opt=t,!this.opt.element)return this.log("No wrapping element specified. Please specify options.element parameter"),void this.opt.noMatch(e);let s=0,r=this.getMethodName(t);if(this.opt.acrossElements&&!e.global&&!e.sticky){let t=e.toString().split("/");e=new RegExp(e.source,"g"+t[t.length-1]),this.log("RegExp is recompiled with g flag because it must have g flag")}this.log(`Searching with expression "${e}"`),this[r](e,this.opt.ignoreGroups,(e,t,r)=>this.opt.filter(t,e,s,r),(e,t)=>{s++,this.opt.each(e,t)},t=>{0===t&&this.opt.noMatch(e),this.opt.done(s,t)})}mark(e,s){if(this.opt=s,!this.opt.element)return this.log("No wrapping element specified. Please specify options.element parameter"),void this.opt.noMatch(e);let r=0,n=0,i=0;const a=this.getMethodName(s),o={},{keywords:h,length:l}=this.getSeparatedKeywords("string"==typeof e?[e]:e),c=e=>{const s=new t(this.opt).create(e);let p=0;this.log(`Searching with expression "${s}"`),this[a](s,1,(t,s,r)=>this.opt.filter(s,e,n,p,r),(e,t)=>{p++,n++,this.opt.each(e,t)},t=>{i+=t,0===t&&this.opt.noMatch(e),o[e]=t,++r<l?c(h[r]):this.opt.done(n,i,o)})};0===l?this.opt.done(0,0,o):c(h[r])}getMethodName(e){if(e){if(e.acrossElements)return e.separateGroups?"wrapGroupsAcrossElements":"wrapMatchesAcrossElements";if(e.separateGroups)return"wrapSeparateGroups"}return"wrapMatches"}markRanges(e,t){if(this.opt=t,!this.opt.element)return this.log("No wrapping element specified. Please specify options.element parameter"),void this.opt.noMatch(e);let s=0,r=this.checkRanges(e);r&&r.length?(this.log("Starting to mark with the following ranges: "+JSON.stringify(r)),this.wrapRangeFromIndex(r,(e,t,s,r)=>this.opt.filter(e,t,s,r),(e,t)=>{s++,this.opt.each(e,t)},e=>{this.opt.done(s,e)})):this.opt.done(0,0)}unmark(t){this.opt=t;let s="[data-markjs]";this.opt.className&&(s+=`.${this.opt.className}`),this.log(`Removal selector "${s}"`),this.iterator.forEachNode(NodeFilter.SHOW_ELEMENT,e=>{this.unwrapMatches(e)},t=>{const r=e.isNotTextRun(t,s),n=this.matchesExclude(t);return!r||n?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},this.opt.done)}}return function(e){const t=new s(e);return this.mark=((e,s)=>(t.mark(e,s),this)),this.markRegExp=((e,s)=>(t.markRegExp(e,s),this)),this.markRanges=((e,s)=>(t.markRanges(e,s),this)),this.unmark=(e=>(t.unmark(e),this)),this}});
